<views:BaseCloudDrivePage
    x:Class="MegaApp.Views.CloudDrivePage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:breadcrumb="using:GoedWare.Controls.Breadcrumb"
    xmlns:views="using:MegaApp.Views"
    xmlns:viewModels="using:MegaApp.ViewModels"
    mc:Ignorable="d"
    d:DataContext="{d:DesignInstance viewModels:CloudDriveViewModel}">

    <Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
        <Grid.RowDefinitions>
            <RowDefinition/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
            <Grid.RowDefinitions>
                <RowDefinition Height="84"/>
                <RowDefinition/>
            </Grid.RowDefinitions>
            <Grid Margin="0,-6,0,0" 
                  DataContext="{Binding ActiveFolderView}">                
                <!--<StackPanel Margin="0,0,24,24" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Bottom">
                    <Button x:Name="BtnGoToTop" HorizontalAlignment="Right" VerticalAlignment="Bottom" Width="48" Height="48" Margin="0,0,24,0" Visibility="{Binding ChildNodes.Count, ConverterParameter=100, Converter={StaticResource CountToVisibilityConverter}, Mode=OneWay}">
                        <Path Stretch="UniformToFill" Data="{Binding LocalizedVisualResources.GoToTopPathData, Mode=OneWay, Source={StaticResource LocalizedStrings}}" Width="20" Height="16" Margin="0,0,0,2"/>
                    </Button>
                    <Button x:Name="BtnGoToBottom" HorizontalAlignment="Right" VerticalAlignment="Bottom" Width="48" Height="48" Margin="0,0,24,0" Visibility="{Binding ChildNodes.Count, ConverterParameter=100, Converter={StaticResource CountToVisibilityConverter}, Mode=OneWay}">
                        <Path Stretch="UniformToFill" Data="{Binding LocalizedVisualResources.GoToBottomPathData, Mode=OneWay, Source={StaticResource LocalizedStrings}}" Width="20" Height="16" Margin="0,0,0,-2"/>
                    </Button>
                    <Button x:Name="BtnChangeView" Command="{Binding ChangeViewCommand}" HorizontalAlignment="Right" VerticalAlignment="Bottom" Width="48" Height="48" Visibility="{Binding HasChildNodesBinding, Converter={StaticResource BooleanToVisibilityConverter}, Mode=OneWay}">
                        <Path Stretch="UniformToFill" Data="{Binding NextViewButtonPathData}" Width="22" Height="22"/>
                    </Button>
                    <Button x:Name="BtnChangeViewDisabled" HorizontalAlignment="Right" VerticalAlignment="Bottom" Width="48" Height="48" IsEnabled="False" Visibility="{Binding HasChildNodesBinding, ConverterParameter=false, Converter={StaticResource BooleanToVisibilityConverter}, Mode=OneWay}">
                        <Path Stretch="UniformToFill" Data="{Binding LocalizedVisualResources.LargeThumbnailViewPathData, Mode=OneWay, Source={StaticResource LocalizedStrings}}" Width="22" Height="22"/>
                    </Button>
                </StackPanel>-->
            </Grid>
            <Grid Grid.Row="1">
                <Pivot x:Name="MainPivot"
                       HeaderTemplate="{StaticResource MegaPivoHeaderTemplate}" 
                       SelectionChanged="OnPivotSelectionChanged">
                    <PivotItem 
                        x:Name="CloudDrivePivot" 
                        Header="{Binding CloudDriveNameText}" 
                        CacheMode="{x:Null}" 
                        Margin="0,-10,0,0">
                        <Grid x:Name="CloudDriveRoot" 
                              Background="Transparent" 
                              Margin="0,0,12,0">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <StackPanel Grid.Row="0">
                                <Grid Margin="24,0,12,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="16"/>
                                        <RowDefinition Height="24"/>
                                    </Grid.RowDefinitions>
                                    <ProgressBar 
                                        VerticalAlignment="Center" 
                                        IsIndeterminate="True" 
                                        Foreground="{StaticResource MegaRedColorBrush}" 
                                        Height="8" 
                                        Grid.ColumnSpan="2" 
                                        Visibility="{Binding CloudDrive.IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                    <breadcrumb:BreadcrumbControl 
                                        x:Name="CloudDriveBreadCrumb"
                                        Margin="-12,0,6,0" Grid.Row="1" Grid.Column="0"
                                        DisplayMemberPath="Name"
                                        HomeCommand="{Binding CloudDrive.HomeSelectedCommand}"
                                        ItemCommand="{Binding CloudDrive.ItemSelectedCommand}"                                        
                                        HomeTemplate="{StaticResource BreadcrumbHomeMegaTemplate}"
                                        ItemTemplate="{StaticResource BreadcrumbItemTemplate}"
                                        Seperator=">"
                                        ItemsSource="{Binding CloudDrive.BreadCrumbs}"
                                        OverFlow="..."/>
                                    <TextBlock 
                                        Text="{Binding CloudDrive.EmptyInformationText}" 
                                        HorizontalAlignment="Right" 
                                        TextAlignment="Right" 
                                        Style="{ThemeResource CaptionTextBlockStyle}" 
                                        Grid.Row="1" 
                                        Grid.Column="1" 
                                        VerticalAlignment="Center"                                         
                                        Visibility="{Binding CloudDrive.HasChildNodesBinding, ConverterParameter=false, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                    <TextBlock 
                                        Text="{Binding CloudDrive.FolderRootNode.Information}" 
                                        HorizontalAlignment="Right" 
                                        TextAlignment="Right" 
                                        Style="{ThemeResource CaptionTextBlockStyle}" 
                                        Grid.Row="1" 
                                        Grid.Column="1" 
                                        VerticalAlignment="Center"                                         
                                        Visibility="{Binding CloudDrive.HasChildNodesBinding, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                </Grid>
                            </StackPanel>
                            <Grid 
                                x:Name="CloudDriveContentPanel" 
                                Grid.Row="1" 
                                Margin="12,0,0,0">
                                <ListView
                                    x:Name="LstCloudDrive"
                                    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
                                    DataContext="{Binding CloudDrive}"
                                    ItemsSource="{Binding ChildNodes}"
                                    Tapped="OnItemTapped"
                                    DoubleTapped="OnItemDoubleTapped"
                                    ItemTemplateSelector="{Binding NodeTemplateSelector}"
                                    Loaded="OnListLoaded"
                                    RightTapped="OnRightTapped"
                                    Holding="OnHolding">
                                    <FlyoutBase.AttachedFlyout>
                                        <MenuFlyout x:Name="CloudDriveMenuFlyout">
                                            <MenuFlyout.Items>
                                                <MenuFlyoutItem 
                                                    Text="{Binding DownloadText}"
                                                    Command="{Binding DownloadItemCommand}"/>
                                                <MenuFlyoutItem 
                                                    Text="{Binding RenameText}" 
                                                    Command="{Binding RenameItemCommand}"/>
                                                <MenuFlyoutItem 
                                                    Text="{Binding MoveToRubbishBinText}" 
                                                    Command="{Binding MoveItemToRubbishBinCommand}"/>
                                            </MenuFlyout.Items>                                            
                                        </MenuFlyout>
                                    </FlyoutBase.AttachedFlyout>
                                </ListView>
                            </Grid>
                        </Grid>
                    </PivotItem>
                    <PivotItem 
                        x:Name="RubbishBinPivot" 
                        Header="{Binding RubbishBinNameText}" 
                        CacheMode="{x:Null}" 
                        Margin="0,-10,0,0">
                        <Grid 
                            x:Name="RubbishBinRoot" 
                            Background="Transparent" 
                            Margin="0,0,12,0">                            
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <StackPanel Grid.Row="0">
                                <Grid Margin="24,0,12,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="16"/>
                                        <RowDefinition Height="24"/>
                                    </Grid.RowDefinitions>
                                    <ProgressBar 
                                        VerticalAlignment="Center" 
                                        IsIndeterminate="True" 
                                        Foreground="{StaticResource MegaRedColorBrush}" 
                                        Height="8" 
                                        Grid.ColumnSpan="2" 
                                        Visibility="{Binding RubbishBin.IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                    <breadcrumb:BreadcrumbControl 
                                        x:Name="RubbishBinBreadCrumb"
                                        Margin="-12,0,6,0" Grid.Row="1" Grid.Column="0"
                                        DisplayMemberPath="Name"
                                        HomeCommand="{Binding RubbishBin.HomeSelectedCommand}"
                                        ItemCommand="{Binding RubbishBin.ItemSelectedCommand}"
                                        HomeTemplate="{StaticResource BreadcrumbHomeRubbishBinTemplate}"
                                        ItemTemplate="{StaticResource BreadcrumbItemTemplate}"
                                        Seperator=">"
                                        ItemsSource="{Binding RubbishBin.BreadCrumbs}"
                                        OverFlow="..."/>
                                    <TextBlock 
                                        Text="{Binding RubbishBin.EmptyInformationText}" 
                                        HorizontalAlignment="Right" 
                                        TextAlignment="Right" 
                                        Style="{ThemeResource CaptionTextBlockStyle}" 
                                        Grid.Row="1" 
                                        Grid.Column="1" 
                                        VerticalAlignment="Center" 
                                        Visibility="{Binding RubbishBin.HasChildNodesBinding, ConverterParameter=false, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                    <TextBlock 
                                        Text="{Binding RubbishBin.FolderRootNode.Information}" 
                                        HorizontalAlignment="Right" 
                                        TextAlignment="Right" 
                                        Style="{ThemeResource CaptionTextBlockStyle}" 
                                        Grid.Row="1" 
                                        Grid.Column="1" 
                                        VerticalAlignment="Center" 
                                        Visibility="{Binding RubbishBin.HasChildNodesBinding, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                </Grid>
                            </StackPanel>

                            <Grid 
                                x:Name="RubbishBinContentPanel" 
                                Grid.Row="1" 
                                Margin="12,0,0,0">
                                <ListView
                                    x:Name="LstRubbishBin"
                                    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
                                    DataContext="{Binding RubbishBin}"
                                    ItemsSource="{Binding ChildNodes}"
                                    Tapped="OnItemTapped"
                                    DoubleTapped="OnItemDoubleTapped"
                                    ItemTemplateSelector="{Binding NodeTemplateSelector}"
                                    Loaded="OnListLoaded"
                                    RightTapped="OnRightTapped"
                                    Holding="OnHolding">
                                    <FlyoutBase.AttachedFlyout>
                                        <MenuFlyout x:Name="RubbishBinMenuFlyout">
                                            <MenuFlyout.Items>
                                                <MenuFlyoutItem 
                                                    Text="{Binding DownloadText}"
                                                    Command="{Binding DownloadItemCommand}"/>
                                                <MenuFlyoutItem 
                                                    Text="{Binding RenameText}"
                                                    Command="{Binding RenameItemCommand}"/>
                                                <MenuFlyoutItem 
                                                    Text="{Binding RemoveText}" 
                                                    Command="{Binding RemoveItemCommand}"/>
                                            </MenuFlyout.Items>
                                        </MenuFlyout>
                                    </FlyoutBase.AttachedFlyout>
                                </ListView>                                
                            </Grid>
                        </Grid>
                    </PivotItem>
                </Pivot>
            </Grid>
        </Grid>

        <CommandBar Grid.Row="1">
            <AppBarButton 
                x:Name="UploadButton"
                Icon="Upload" 
                Label="{Binding UploadText}" 
                Command="{Binding ActiveFolderView.UploadCommand}"
                Click="OnButtonClick"/>
            <AppBarButton 
                x:Name="AddFolderButton"
                Icon="NewFolder" 
                Label="{Binding AddFolderText}" 
                Command="{Binding ActiveFolderView.AddFolderCommand}"
                Click="OnButtonClick"/>
            <AppBarButton 
                x:Name="CleanRubbishBinButton"
                Icon="Delete" 
                Label="{Binding EmptyRubbishBinText}" 
                Command="{Binding ActiveFolderView.CleanRubbishBinCommand}"
                Click="OnButtonClick"/>
            
            <CommandBar.SecondaryCommands>
                <AppBarButton
                x:Name="RefreshButton"
                Icon="Refresh" 
                Label="{Binding RefreshText}" 
                Command="{Binding ActiveFolderView.RefreshCommand}"
                Click="OnButtonClick"/>
            </CommandBar.SecondaryCommands>
        </CommandBar>
    </Grid>
</views:BaseCloudDrivePage>
    